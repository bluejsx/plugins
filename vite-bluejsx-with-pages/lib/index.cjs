var _=Object.create;var m=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,C=Object.prototype.hasOwnProperty;var h=e=>m(e,"__esModule",{value:!0});var j=(e,t)=>{h(e);for(var i in t)m(e,i,{get:t[i],enumerable:!0})},k=(e,t,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of b(t))!C.call(e,r)&&r!=="default"&&m(e,r,{get:()=>t[r],enumerable:!(i=$(t,r))||i.enumerable});return e},c=e=>k(h(m(e!=null?_(x(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);j(exports,{default:()=>P});var y=c(require("directory-tree")),o=c(require("path")),S=c(require("vite")),w=c(require("vite-with-bluejsx")),n=c(require("fs")),v=c(require("deepmerge"));function P(e){var f;(0,w.default)(e);let t={},i=F(),r=(0,o.resolve)(i,"./pages"),s=(0,o.resolve)(i,"./.bluepages");try{(0,n.statSync)(s),n.default.rmSync(s,{recursive:!0})}catch{n.default.mkdirSync(s,{recursive:!0})}let U=(0,y.default)(r,{extensions:/\.(md|mdx|js|jsx|ts|tsx)$/,normalizePath:!0},({name:p},l)=>{let a=p.replace(/.[\w]+$/,"");if(a.indexOf("_")===0)return null;let d=(0,o.relative)(i+"/pages",l),u=(0,o.resolve)(s+"/"+d,"../");n.default.mkdirSync(u,{recursive:!0});let g=(0,o.resolve)(u,`./${a}.html`);n.default.writeFileSync((0,o.resolve)(u,`./${a}.js`),`import Component from '${(0,o.relative)(u,l)}';import('${(0,o.relative)(u,r)}/_app').then(({default: Page})=>document.querySelector('#app').appendChild(Page({Component,pageProps:{}})))`);let D=n.default.readFileSync(`${r}/_template.html`,"utf-8").replace("</body",`<script type="module" src="./${a}.js"><\/script></body`);n.default.writeFileSync(g,D),t[d.replace(/\//,"_").replace(/.[\w]+$/,"")]=g});return(f=e.plugins)!=null||(e.plugins=[]),e.plugins.push({name:"with-pages-listen-dir",async configureServer(p){let{watcher:l}=p;l.add(r),l.on("add",(a,d)=>{a.includes(r)&&O(p)})}}),(0,v.default)(e,{build:{rollupOptions:{input:t},emptyOutDir:!0,outDir:(0,o.relative)(s,(0,o.resolve)(i,"./dist"))},root:s,publicDir:i+"/public"})}function F(){for(let e of module.paths)try{let t=(0,o.dirname)(e);return(0,n.accessSync)(e,n.constants.F_OK),t}catch{}}async function O(e){global.__vite_start_time=Date.now();let{port:t}=e.config.server;await e.close();let i=null;try{i=await(0,S.createServer)(e.config.inlineConfig)}catch(r){e.config.logger.error(r.message,{timestamp:!0});return}for(let r in i)r!=="app"&&(e[r]=i[r]);e.config.server.middlewareMode?e.config.logger.info("server restarted.",{timestamp:!0}):await e.listen(t,!0)}0&&(module.exports={});
